// Generated by CoffeeScript 1.12.2
(function() {
  var Promise, errorAttributes, pick, request;

  request = require('request');

  Promise = require('bluebird');

  pick = require('lodash.pick');

  errorAttributes = ['statusCode', 'statusMessage', 'headers', 'body'];

  module.exports = function(config) {
    return new Promise(function(resolve, reject) {
      return request(config, function(err, res) {
        var data;
        if (err != null) {
          return reject(err);
        } else {
          if (res.statusCode < 400) {
            return resolve(res);
          } else {
            err = new Error(res.statusMessage);
            data = pick(res, errorAttributes);
            data.url = res.request.uri.href;
            Object.assign(err, data);
            return reject(err);
          }
        }
      });
    });
  };

}).call(this);
